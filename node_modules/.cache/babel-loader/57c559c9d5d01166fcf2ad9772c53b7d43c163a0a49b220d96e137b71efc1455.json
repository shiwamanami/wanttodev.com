{"ast":null,"code":"import{useState,useEffect}from\"react\";import{recentBookISBNs}from\"../data/recentBooks\";// Google Books APIのレスポンス型定義\n// コンポーネントで使用する書籍情報の型\nexport function useRecentBooks(){const[books,setBooks]=useState([]);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchBooks=async()=>{if(recentBookISBNs.length===0){setIsLoading(false);return;}try{setIsLoading(true);setError(null);// Google Books APIを呼び出し（各ISBNを個別に取得）\nconst bookPromises=recentBookISBNs.map(async isbn=>{try{var _volumeInfo$imageLink,_volumeInfo$imageLink2,_volumeInfo$imageLink3,_volumeInfo$imageLink4,_volumeInfo$industryI,_volumeInfo$industryI2;const response=await fetch(\"https://www.googleapis.com/books/v1/volumes?q=isbn:\".concat(isbn));if(!response.ok){throw new Error(\"API\\u30EA\\u30AF\\u30A8\\u30B9\\u30C8\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F: \".concat(response.statusText));}const data=await response.json();if(!data.items||data.items.length===0){console.warn(\"\\u26A0\\uFE0F ISBN \".concat(isbn,\" \\u306E\\u66F8\\u7C4D\\u60C5\\u5831\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u305B\\u3093\\u3067\\u3057\\u305F\\u3002\"));return null;}const volume=data.items[0];const volumeInfo=volume.volumeInfo;// 表紙画像のURLを取得（大きいサイズを優先）\nconst coverUrl=((_volumeInfo$imageLink=volumeInfo.imageLinks)===null||_volumeInfo$imageLink===void 0?void 0:_volumeInfo$imageLink.large)||((_volumeInfo$imageLink2=volumeInfo.imageLinks)===null||_volumeInfo$imageLink2===void 0?void 0:_volumeInfo$imageLink2.medium)||((_volumeInfo$imageLink3=volumeInfo.imageLinks)===null||_volumeInfo$imageLink3===void 0?void 0:_volumeInfo$imageLink3.thumbnail)||((_volumeInfo$imageLink4=volumeInfo.imageLinks)===null||_volumeInfo$imageLink4===void 0?void 0:_volumeInfo$imageLink4.smallThumbnail)||\"\";// ISBNを取得（industryIdentifiersから）\nconst isbn13=((_volumeInfo$industryI=volumeInfo.industryIdentifiers)===null||_volumeInfo$industryI===void 0?void 0:(_volumeInfo$industryI2=_volumeInfo$industryI.find(id=>id.type===\"ISBN_13\"))===null||_volumeInfo$industryI2===void 0?void 0:_volumeInfo$industryI2.identifier)||isbn;return{isbn:isbn13,title:volumeInfo.title||\"\",subtitle:volumeInfo.subtitle,author:(volumeInfo.authors||[]).join(\", \")||\"不明\",publisher:volumeInfo.publisher||\"\",pubdate:volumeInfo.publishedDate||\"\",cover:coverUrl.replace(\"&edge=curl\",\"\"),// edge=curlパラメータを削除\nsummary:volumeInfo.description||\"\",pageCount:volumeInfo.pageCount,categories:volumeInfo.categories,averageRating:volumeInfo.averageRating,ratingsCount:volumeInfo.ratingsCount,language:volumeInfo.language,previewLink:volumeInfo.previewLink,infoLink:volumeInfo.infoLink};}catch(err){console.error(\"\\u274C ISBN \".concat(isbn,\" \\u306E\\u53D6\\u5F97\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F:\"),err);return null;}});const bookResults=await Promise.all(bookPromises);const validBooks=bookResults.filter(book=>book!==null);console.log(\"✅ 書籍データ取得成功:\",validBooks.length,\"件\");setBooks(validBooks);}catch(err){console.error(\"❌ 書籍データの取得に失敗しました:\",err);setError(err instanceof Error?err.message:\"不明なエラーが発生しました\");setBooks([]);}finally{setIsLoading(false);}};fetchBooks();},[]);return{books,isLoading,error};}","map":{"version":3,"names":["useState","useEffect","recentBookISBNs","useRecentBooks","books","setBooks","isLoading","setIsLoading","error","setError","fetchBooks","length","bookPromises","map","isbn","_volumeInfo$imageLink","_volumeInfo$imageLink2","_volumeInfo$imageLink3","_volumeInfo$imageLink4","_volumeInfo$industryI","_volumeInfo$industryI2","response","fetch","concat","ok","Error","statusText","data","json","items","console","warn","volume","volumeInfo","coverUrl","imageLinks","large","medium","thumbnail","smallThumbnail","isbn13","industryIdentifiers","find","id","type","identifier","title","subtitle","author","authors","join","publisher","pubdate","publishedDate","cover","replace","summary","description","pageCount","categories","averageRating","ratingsCount","language","previewLink","infoLink","err","bookResults","Promise","all","validBooks","filter","book","log","message"],"sources":["/Users/shiwa/Desktop/wanttodev.com/src/hooks/useRecentBooks.ts"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { recentBookISBNs } from \"../data/recentBooks\";\n\n// Google Books APIのレスポンス型定義\ninterface GoogleBooksResponse {\n  kind: string;\n  totalItems: number;\n  items?: Array<{\n    id: string;\n    volumeInfo: {\n      title: string;\n      subtitle?: string;\n      authors?: string[];\n      publisher?: string;\n      publishedDate?: string;\n      description?: string;\n      pageCount?: number;\n      categories?: string[];\n      averageRating?: number;\n      ratingsCount?: number;\n      language?: string;\n      imageLinks?: {\n        smallThumbnail?: string;\n        thumbnail?: string;\n        small?: string;\n        medium?: string;\n        large?: string;\n        extraLarge?: string;\n      };\n      industryIdentifiers?: Array<{\n        type: string;\n        identifier: string;\n      }>;\n      previewLink?: string;\n      infoLink?: string;\n    };\n  }>;\n}\n\n// コンポーネントで使用する書籍情報の型\nexport interface BookInfo {\n  isbn: string;\n  title: string;\n  subtitle?: string;\n  author: string;\n  publisher: string;\n  pubdate: string;\n  cover: string;\n  summary: string;\n  pageCount?: number;\n  categories?: string[];\n  averageRating?: number;\n  ratingsCount?: number;\n  language?: string;\n  previewLink?: string;\n  infoLink?: string;\n}\n\nexport function useRecentBooks() {\n  const [books, setBooks] = useState<BookInfo[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchBooks = async () => {\n      if (recentBookISBNs.length === 0) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        setIsLoading(true);\n        setError(null);\n\n        // Google Books APIを呼び出し（各ISBNを個別に取得）\n        const bookPromises = recentBookISBNs.map(async (isbn) => {\n          try {\n            const response = await fetch(\n              `https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`\n            );\n\n            if (!response.ok) {\n              throw new Error(`APIリクエストに失敗しました: ${response.statusText}`);\n            }\n\n            const data: GoogleBooksResponse = await response.json();\n\n            if (!data.items || data.items.length === 0) {\n              console.warn(`⚠️ ISBN ${isbn} の書籍情報が見つかりませんでした。`);\n              return null;\n            }\n\n            const volume = data.items[0];\n            const volumeInfo = volume.volumeInfo;\n\n            // 表紙画像のURLを取得（大きいサイズを優先）\n            const coverUrl =\n              volumeInfo.imageLinks?.large ||\n              volumeInfo.imageLinks?.medium ||\n              volumeInfo.imageLinks?.thumbnail ||\n              volumeInfo.imageLinks?.smallThumbnail ||\n              \"\";\n\n            // ISBNを取得（industryIdentifiersから）\n            const isbn13 = volumeInfo.industryIdentifiers?.find(\n              (id) => id.type === \"ISBN_13\"\n            )?.identifier || isbn;\n\n            return {\n              isbn: isbn13,\n              title: volumeInfo.title || \"\",\n              subtitle: volumeInfo.subtitle,\n              author: (volumeInfo.authors || []).join(\", \") || \"不明\",\n              publisher: volumeInfo.publisher || \"\",\n              pubdate: volumeInfo.publishedDate || \"\",\n              cover: coverUrl.replace(\"&edge=curl\", \"\"), // edge=curlパラメータを削除\n              summary: volumeInfo.description || \"\",\n              pageCount: volumeInfo.pageCount,\n              categories: volumeInfo.categories,\n              averageRating: volumeInfo.averageRating,\n              ratingsCount: volumeInfo.ratingsCount,\n              language: volumeInfo.language,\n              previewLink: volumeInfo.previewLink,\n              infoLink: volumeInfo.infoLink,\n            };\n          } catch (err) {\n            console.error(`❌ ISBN ${isbn} の取得に失敗しました:`, err);\n            return null;\n          }\n        });\n\n        const bookResults = await Promise.all(bookPromises);\n        const validBooks: BookInfo[] = bookResults.filter(\n          (book): book is BookInfo => book !== null\n        );\n\n        console.log(\"✅ 書籍データ取得成功:\", validBooks.length, \"件\");\n        setBooks(validBooks);\n      } catch (err) {\n        console.error(\"❌ 書籍データの取得に失敗しました:\", err);\n        setError(\n          err instanceof Error ? err.message : \"不明なエラーが発生しました\"\n        );\n        setBooks([]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchBooks();\n  }, []);\n\n  return { books, isLoading, error };\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}